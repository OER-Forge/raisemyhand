# RaiseMyHand Demo Environment
# Runs on port 8000 with auto-loaded demo data
# Database resets to fresh demo data on each restart
#
# Quick Start:
#   docker compose -f docker-compose.demo.yml up -d
#
# To stop:
#   docker compose -f docker-compose.demo.yml down

services:
  demo:
    build: .
    container_name: raisemyhand-demo
    ports:
      - "8000:8000"
    volumes:
      - demo-data:/app/data
      - ./demo/data:/app/demo/data:ro
    environment:
      # Demo Configuration
      - DEMO_MODE=true
      - DEMO_CONTEXT=${DEMO_CONTEXT:-physics_101}
      - DATABASE_URL=sqlite:///./data/demo_raisemyhand.db

      # Server Configuration
      - HOST=0.0.0.0
      - PORT=8000
      - BASE_URL=${BASE_URL:-http://localhost:8000}
      - TIMEZONE=${TIMEZONE:-UTC}

      # Admin Credentials (Demo defaults)
      - ADMIN_USERNAME=admin
      - ADMIN_PASSWORD=demo123

      # Security (Demo mode - less strict)
      - DEBUG=false

    command: >
      sh -c "
        echo 'ğŸ¯ Starting RaiseMyHand DEMO Environment' &&
        echo 'ğŸ“¦ Demo Context: ${DEMO_CONTEXT:-physics_101}' &&
        echo 'ğŸ”‘ Login: admin / demo123' &&
        echo '' &&
        echo 'âš ï¸  Demo mode: Database resets on container restart' &&
        echo 'ğŸ“ Access at: http://localhost:8000' &&
        echo '' &&
        if [ ! -d demo/data/${DEMO_CONTEXT:-physics_101} ]; then
          echo 'ğŸ“ Generating demo context...' &&
          python demo/generate_context.py --context ${DEMO_CONTEXT:-physics_101}
        fi &&
        echo 'ğŸ—„ï¸  Initializing fresh database...' &&
        python init_db_v2.py &&
        echo 'ğŸ“¥ Loading demo data...' &&
        python demo/load_demo_context.py ${DEMO_CONTEXT:-physics_101} &&
        echo 'âœ… Demo data loaded successfully' &&
        echo '' &&
        echo 'ğŸš€ Starting server...' &&
        uvicorn main:app --host 0.0.0.0 --port 8000
      "

    restart: unless-stopped

volumes:
  demo-data:
    driver: local
